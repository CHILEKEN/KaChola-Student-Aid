<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KaChola Student Aid â€“ Quick Short-Term Loans</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root { --primary: #4B2E1A; --accent: #D4AF37; --bg: #F5F0E9; }
    body {
      min-height: 100vh;
      font-family: system-ui, sans-serif;
      color: #333;
      background-color: #F5F0E9;
      position: relative;
      z-index: 0;
    }
    body::before {
      content: "";
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(255, 255, 255, 0.6);
      z-index: -1;
    }
    .card {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(229,231,235,0.5);
      border-radius: 1rem;
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
    }
    .navbar {
      background-color: rgba(75, 46, 26, 0.9);
      backdrop-filter: blur(4px);
      transition: transform 0.3s ease-in-out;
    }
    .step-indicator > div {
      width: 2rem; height: 2rem; border-radius: 50%;
      background-color: #e5e7eb; margin: 0 0.25rem;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 0.8rem;
    }
    .step-indicator > div.active { background-color: var(--accent); color: var(--primary); }
    .step-indicator > div.completed { background-color: var(--primary); color: white; }
    .error-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: 1000;
      display: flex; align-items: center; justify-content: center;
      visibility: hidden; opacity: 0; transition: 0.3s;
    }
    .error-overlay.show { visibility: visible; opacity: 1; }
    .error-box { background: white; padding: 2rem; border-radius: 1rem; text-align: center; max-width: 90%; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const formatZMW = (v) => "K " + Number(v).toLocaleString('en-ZM', { minimumFractionDigits: 2 });
    
    const getSavedValue = (key, def) => {
      const saved = localStorage.getItem(key);
      if (!saved) return def;
      try { return JSON.parse(saved); } catch { return saved; }
    };

    const setSavedValue = (key, val) => {
      localStorage.setItem(key, typeof val === 'object' ? JSON.stringify(val) : val);
    };

    function App() {
      const [activeTab, setActiveTab] = useState(() => getSavedValue('kachola_tab', 'apply'));
      const [currentStep, setCurrentStep] = useState(0);
      const [loans, setLoans] = useState(() => getSavedValue('kachola_loans', []));
      const [errorMessage, setErrorMessage] = useState(null);

      // Form States
      const [formData, setFormData] = useState({
        firstName: '', lastName: '', nrc: '', institution: '', studentId: '', 
        year: '', program: '', phone: '', email: '', parentPhone: '',
        amount: '', weeks: '', collateralType: '', ownership: ''
      });

      useEffect(() => { setSavedValue('kachola_tab', activeTab); }, [activeTab]);
      useEffect(() => { setSavedValue('kachola_loans', loans); }, [loans]);

      const handleInput = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
        setErrorMessage(null);
      };

      const validateStep = () => {
        if (currentStep === 0 && (!formData.firstName || !formData.lastName)) return "Name is required";
        if (currentStep === 1 && !formData.institution) return "Institution is required";
        if (currentStep === 5 && (formData.amount < 200 || formData.amount > 5000)) return "Amount must be K200 - K5000";
        return null;
      };

      const next = () => {
        const err = validateStep();
        if (err) setErrorMessage(err);
        else setCurrentStep(s => s + 1);
      };

      const submit = () => {
        const newLoan = { ...formData, id: Date.now(), status: 'Pending', date: new Date().toLocaleDateString() };
        setLoans([...loans, newLoan]);
        alert("Application Submitted!");
        setActiveTab('myloans');
      };

      return (
        <div className="min-h-screen flex flex-col">
          <div className={`error-overlay ${errorMessage ? 'show' : ''}`}>
            <div className="error-box">
              <h3 className="text-red-600 font-bold text-xl mb-2">Notice</h3>
              <p className="mb-4">{errorMessage}</p>
              <button onClick={() => setErrorMessage(null)} className="bg-red-600 text-white px-6 py-2 rounded">OK</button>
            </div>
          </div>

          <nav className="navbar text-white p-4 sticky top-0 z-50">
            <div className="max-w-5xl mx-auto flex justify-between items-center">
              <h1 className="font-bold text-xl">KaChola <span className="text-[var(--accent)]">Aid</span></h1>
              <div className="space-x-2">
                <button onClick={() => setActiveTab('apply')} className="text-xs sm:text-sm bg-white/20 px-3 py-1 rounded">Apply</button>
                <button onClick={() => setActiveTab('myloans')} className="text-xs sm:text-sm bg-white/20 px-3 py-1 rounded">Status</button>
              </div>
            </div>
          </nav>

          <main className="flex-grow p-4 max-w-4xl mx-auto w-full mt-4">
            {activeTab === 'apply' && (
              <div className="card p-6">
                <div className="step-indicator flex justify-center mb-6">
                  {[1,2,3,4,5,6].map(i => (
                    <div key={i} className={currentStep >= i-1 ? 'active' : ''}>{i}</div>
                  ))}
                </div>

                {currentStep === 0 && (
                  <div className="space-y-4">
                    <h2 className="text-xl font-bold">Personal Details</h2>
                    <input name="firstName" placeholder="First Name" className="w-full p-3 border rounded" onChange={handleInput} />
                    <input name="lastName" placeholder="Last Name" className="w-full p-3 border rounded" onChange={handleInput} />
                  </div>
                )}

                {currentStep === 5 && (
                  <div className="space-y-4">
                    <h2 className="text-xl font-bold">Loan Details</h2>
                    <input name="amount" type="number" placeholder="Amount (K200 - K5000)" className="w-full p-3 border rounded" onChange={handleInput} />
                    <select name="weeks" className="w-full p-3 border rounded" onChange={handleInput}>
                        <option>1 Week</option>
                        <option>2 Weeks</option>
                        <option>4 Weeks</option>
                    </select>
                  </div>
                )}

                <div className="flex justify-between mt-8">
                  {currentStep > 0 && <button onClick={() => setCurrentStep(s => s - 1)} className="text-gray-500">Back</button>}
                  {currentStep < 5 ? 
                    <button onClick={next} className="bg-[var(--primary)] text-white px-8 py-3 rounded-lg ml-auto">Next</button> :
                    <button onClick={submit} className="bg-green-700 text-white px-8 py-3 rounded-lg ml-auto">Submit</button>
                  }
                </div>
              </div>
            )}

            {activeTab === 'myloans' && (
              <div className="space-y-4">
                <h2 className="text-2xl font-bold">Your Applications</h2>
                {loans.map(l => (
                  <div key={l.id} className="card p-4 flex justify-between">
                    <div>
                      <p className="font-bold">K {l.amount}</p>
                      <p className="text-xs text-gray-500">{l.date}</p>
                    </div>
                    <span className="text-orange-600 font-medium">{l.status}</span>
                  </div>
                ))}
              </div>
            )}
          </main>

          <footer className="bg-[var(--primary)] text-white p-8 mt-10 text-center">
            <a href="https://wa.me/260979236667" className="inline-block bg-green-500 px-6 py-3 rounded-full font-bold">WhatsApp Support</a>
            <p className="mt-4 opacity-50">&copy; 2026 KaChola Student Aid</p>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
